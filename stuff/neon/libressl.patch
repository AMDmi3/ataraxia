From 335176a1e9ccc40798d801a357fcaf590343e88d Mon Sep 17 00:00:00 2001
From: Juan RP <xtraeme@gmail.com>
Date: Thu, 2 Apr 2020 09:56:40 +0200
Subject: [PATCH] src/ne_socket.c: fix for LibreSSL.

Treat LibreSSL as OpenSSL < 1.1.1.
---
 src/ne_socket.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/ne_socket.c b/src/ne_socket.c
index d19fd82..bf8e292 100644
--- a/src/ne_socket.c
+++ b/src/ne_socket.c
@@ -610,7 +610,7 @@ static int error_ossl(ne_socket *sock, int sret);
 /* OpenSSL I/O function implementations. */
 static int readable_ossl(ne_socket *sock, int secs)
 {
-#if OPENSSL_VERSION_NUMBER < 0x10101000L
+#if defined(LIBRESSL_VERSION_NUMBER) || OPENSSL_VERSION_NUMBER < 0x10101000L
     /* Sufficient for TLSv1.2 and earlier. */
     if (SSL_pending(sock->ssl))
 	return 0;

From 4d0f3368e7735a4b83f23db5ba5f29ff4b65754f Mon Sep 17 00:00:00 2001
From: Juan RP <xtraeme@gmail.com>
Date: Thu, 2 Apr 2020 09:54:43 +0200
Subject: [PATCH] src/ne_openssl.c: fix for LibreSSL.

SSL_CTX_set_post_handshake_auth is OpenSSL specific and
does not seem to be supported in LibreSSL.
---
 src/ne_openssl.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/ne_openssl.c b/src/ne_openssl.c
index 89e3ced..7480510 100644
--- a/src/ne_openssl.c
+++ b/src/ne_openssl.c
@@ -578,7 +578,7 @@ ne_ssl_context *ne_ssl_context_create(int mode)
         /* enable workarounds for buggy SSL server implementations */
         SSL_CTX_set_options(ctx->ctx, SSL_OP_ALL);
         SSL_CTX_set_verify(ctx->ctx, SSL_VERIFY_PEER, verify_callback);
-#if OPENSSL_VERSION_NUMBER >= 0x10101000L
+#if !defined(LIBRESSL_VERSION_NUMBER) && OPENSSL_VERSION_NUMBER >= 0x10101000L
         SSL_CTX_set_post_handshake_auth(ctx->ctx, 1);
 #endif
     } else if (mode == NE_SSL_CTX_SERVER) {
